<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quiz Nube — Simple (examen.json)</title>
  <style>
    :root { --bg:#f6f7fb; --card:#fff; --ink:#0f172a; --muted:#475569; --line:#e2e8f0; }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu; background:var(--bg); color:var(--ink)}
    .container{max-width:900px; margin:0 auto; padding:24px}
    .card{background:var(--card); border:1px solid var(--line); border-radius:16px; box-shadow:0 4px 16px rgba(0,0,0,.04)}
    header{padding:16px}
    header h1{margin:0 0 6px 0; font-size:22px}
    header p{margin:0; color:var(--muted)}
    .btn{appearance:none; border:1px solid var(--line); background:#fff; padding:10px 14px; border-radius:12px; cursor:pointer}
    .btn.primary{background:#111827; color:#fff; border-color:transparent}
    .btn:disabled{opacity:.6; cursor:not-allowed}
    .toolbar{display:flex; gap:8px; padding:12px 16px; border-top:1px solid var(--line)}
    .q{padding:16px; border-top:1px solid var(--line)}
    .q:first-child{border-top:none}
    .q h3{margin:0 0 8px 0; font-size:16px}
    .opt{display:flex; gap:8px; align-items:flex-start; padding:8px; border:1px solid var(--line); border-radius:10px; margin:6px 0}
    .opt.correct{background:#ecfdf5; border-color:#86efac}
    .opt.wrong{background:#fff1f2; border-color:#fda4af}
    .result{padding:12px 16px; border-top:1px solid var(--line)}
    .result strong{color:#111827}
    .msg{padding:12px 16px; border-top:1px solid var(--line); color:#334155}
    .muted{color:#64748b}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <header>
        <h1>Cuestionario de Computación en la Nube</h1>
        <p>Este HTML carga las preguntas desde <code>examen.json</code> (mismo directorio).</p>
      </header>

      <div id="loading" class="msg">Cargando <code>examen.json</code>…</div>
      <div id="error" class="msg" style="display:none; color:#b91c1c"></div>
      <div id="quiz" style="display:none"></div>

      <div class="toolbar">
        <button class="btn primary" id="btnGrade" disabled>Calificar</button>
        <button class="btn" id="btnRetry" disabled>Reintentar</button>
        <span class="muted" id="foot"></span>
      </div>
      <div id="result" class="result" style="display:none"></div>
    </div>
  </div>

  <script>
    // === Carga externa ===
    // Coloca un archivo "examen.json" junto a este HTML con el mismo formato:
    // [ { question: string, options: string[], correct_answer: number }, ... ]

    let DATA = [];             // preguntas cargadas
    let user = {};             // { qi: optionIndex }
    let graded = false;        // ya calificado
    let loaded = false;        // JSON cargado

    // Refs UI
    const quizEl = document.getElementById('quiz');
    const btnGrade = document.getElementById('btnGrade');
    const btnRetry = document.getElementById('btnRetry');
    const resultEl = document.getElementById('result');
    const loadingEl = document.getElementById('loading');
    const errorEl = document.getElementById('error');
    const footEl = document.getElementById('foot');

    async function loadJSON(){
      try{
        // "no-store" para evitar cache cuando edites el JSON
        const res = await fetch('examen.json', { cache: 'no-store' });
        if(!res.ok) throw new Error('HTTP ' + res.status);
        const json = await res.json();
        if(!Array.isArray(json)) throw new Error('El JSON debe ser un arreglo.');
        json.forEach((q,i)=>{
          if(!q.question || !Array.isArray(q.options)) throw new Error(`Pregunta ${i+1} inválida.`);
          if(typeof q.correct_answer !== 'number') throw new Error(`Falta correct_answer en pregunta ${i+1}.`);
        });
        DATA = json;
        loaded = true;
        loadingEl.style.display = 'none';
        errorEl.style.display = 'none';
        quizEl.style.display = 'block';
        render();
        updateControls();
        footEl.textContent = `${DATA.length} preguntas`;
      }catch(e){
        loadingEl.style.display = 'none';
        errorEl.style.display = 'block';
        errorEl.textContent = 'No se pudo cargar examen.json: ' + e.message + '\n\nSugerencia: sirve este HTML con un servidor local (por ejemplo: "python -m http.server 8080") y coloca examen.json en el mismo directorio.';
      }
    }

    function render(){
      quizEl.innerHTML = '';
      DATA.forEach((q, qi) => {
        const qWrap = document.createElement('div');
        qWrap.className = 'q';
        const h = document.createElement('h3');
        h.textContent = `${qi+1}. ${q.question}`;
        qWrap.appendChild(h);
        q.options.forEach((opt, oi) => {
          const label = document.createElement('label');
          const isChecked = user[qi] === oi;
          const isRight = graded && q.correct_answer === oi;
          const isWrong = graded && isChecked && !isRight;
          label.className = 'opt' + (isRight ? ' correct' : isWrong ? ' wrong' : '');
          const input = document.createElement('input');
          input.type = 'radio';
          input.name = `q-${qi}`;
          input.checked = isChecked;
          input.addEventListener('change', () => { user[qi] = oi; updateControls(); });
          const text = document.createElement('span');
          text.textContent = String.fromCharCode(65+oi) + '. ' + opt;
          label.appendChild(input);
          label.appendChild(text);
          qWrap.appendChild(label);
        });
        quizEl.appendChild(qWrap);
      });
    }

    function updateControls(){
      const answered = Object.keys(user).length;
      btnGrade.disabled = !loaded || answered < DATA.length;
      btnRetry.disabled = !graded;
    }

    function grade(){
      graded = true;
      let ok = 0;
      DATA.forEach((q,i)=>{ if(user[i] === q.correct_answer) ok++; });
      const pct = Math.round((ok / DATA.length) * 100);
      render();
      resultEl.style.display = 'block';
      resultEl.innerHTML = `<strong>Resultado:</strong> ${ok} / ${DATA.length} — <strong>${pct}%</strong>`;
      updateControls();
      window.scrollTo({top:0, behavior:'smooth'});
    }

    function retry(){
      graded = false; user = {}; resultEl.style.display = 'none'; resultEl.innerHTML = '';
      render(); updateControls();
      window.scrollTo({top:0, behavior:'smooth'});
    }

    btnGrade.addEventListener('click', grade);
    btnRetry.addEventListener('click', retry);

    // Cargar JSON al inicio
    loadJSON();
  </script>
</body>
</html>